import{a as A}from"./chunk-YRPVFBOT.js";import{b as N,c,d as T,e as F,h as B,j as V,k as z,q as D,s as q}from"./chunk-BC33UU65.js";import{a as G}from"./chunk-2I2HCIQQ.js";import{b as E}from"./chunk-4CTQDGJF.js";import"./chunk-NAK5AQJJ.js";import{a as O}from"./chunk-ASCYJVIG.js";import{e as k,g as I,h as R}from"./chunk-5CKBWUIT.js";import"./chunk-QRIHUA6I.js";import{Jb as w,Ka as i,Lb as m,Mb as d,W as p,Ya as b,Z as M,_a as C,cb as v,hb as n,ia as _,ib as t,ic as P,ja as y,jb as g,lb as S,mb as f,wb as a,xb as l,yb as h}from"./chunk-KOA5EEQG.js";function L(r,x){if(r&1&&(n(0,"div",5),_(),n(1,"svg",20),g(2,"path",21)(3,"polyline",22),t(),y(),n(4,"div")(5,"strong"),a(6),t(),n(7,"p"),a(8,"Complete registration to accept your invitation"),t()()()),r&2){let o=f();i(6),h("You're invited to join ",o.invitationInfo.corporateName,"")}}function j(r,x){r&1&&(n(0,"p",23),a(1,"Create your account to get started"),t())}function H(r,x){if(r&1&&(n(0,"div",15),a(1),t()),r&2){let o=f();i(),l(o.errorMessage)}}function W(r,x){if(r&1&&(n(0,"div",16),a(1),t()),r&2){let o=f();i(),l(o.successMessage)}}var ne=(()=>{class r{constructor(){this.fb=p(D),this.authService=p(O),this.invitationService=p(G),this.router=p(I),this.route=p(k),this.loading=!1,this.errorMessage="",this.successMessage="",this.invitationToken=null,this.invitationInfo=null,this.registerForm=this.fb.group({firstName:["",c.required],lastName:["",c.required],email:[{value:"",disabled:!1},[c.required,c.email]],password:["",[c.required,c.minLength(6)]]})}ngOnInit(){this.route.queryParams.subscribe(o=>{let s=o.invitation;s&&(this.invitationToken=s,this.loading=!0,this.errorMessage="",this.invitationService.validateInvitation(s).subscribe({next:e=>{e.valid?(this.invitationInfo=e,this.registerForm.patchValue({email:e.email}),this.registerForm.get("email")?.disable()):this.errorMessage=e.errorMessage||"Invalid invitation",this.loading=!1},error:e=>{this.errorMessage="Failed to validate invitation",this.loading=!1,console.error("Error validating invitation:",e)}}))})}onSubmit(){if(this.registerForm.valid){this.loading=!0,this.errorMessage="";let o=this.registerForm.getRawValue(),s={email:o.email,firstName:o.firstName,lastName:o.lastName,password:o.password};this.authService.register(s).subscribe({next:e=>{this.invitationToken?this.authService.login({email:s.email,password:s.password}).subscribe({next:()=>{this.invitationService.acceptInvitation(this.invitationToken).subscribe({next:()=>{this.successMessage="Registration successful! Invitation accepted. Redirecting...",setTimeout(()=>this.router.navigate(["/admin/dashboard"]),2e3)},error:u=>{console.error("Error accepting invitation:",u),this.successMessage="Registration successful! Redirecting to login...",setTimeout(()=>this.router.navigate(["/login"]),2e3)}})},error:u=>{console.error("Auto-login error:",u),this.successMessage="Registration successful! Redirecting to login...",setTimeout(()=>this.router.navigate(["/login"]),2e3)}}):(this.successMessage="Registration successful! Redirecting to login...",setTimeout(()=>this.router.navigate(["/login"]),2e3))},error:e=>{console.error("Registration error:",e),this.errorMessage=e.error?.message||e.error||e.message||"Registration failed",this.loading=!1}})}}static{this.\u0275fac=function(s){return new(s||r)}}static{this.\u0275cmp=M({type:r,selectors:[["app-register"]],standalone:!0,features:[w],decls:46,vars:34,consts:[[1,"auth-page"],[1,"auth-container"],[1,"auth-card","fade-in"],[1,"auth-header"],[1,"auth-title"],[1,"invitation-banner"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group"],[1,"form-label"],["type","text","formControlName","firstName",1,"form-control"],["type","text","formControlName","lastName",1,"form-control"],["type","email","formControlName","email",1,"form-control"],["type","password","formControlName","password",1,"form-control"],[1,"form-hint"],[1,"alert","alert-danger"],[1,"alert","alert-success"],["type","submit","variant","primary",3,"fullWidth","loading","disabled"],[1,"auth-footer"],["routerLink","/login",1,"auth-link"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"],["points","22,6 12,13 2,6"],[1,"auth-subtitle"]],template:function(s,e){s&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),a(5),m(6,"translate"),t(),b(7,L,9,1,"div",5)(8,j,2,0),t(),n(9,"form",6),S("ngSubmit",function(){return e.onSubmit()}),n(10,"div",7)(11,"div",8)(12,"label",9),a(13),m(14,"translate"),t(),g(15,"input",10),t(),n(16,"div",8)(17,"label",9),a(18),m(19,"translate"),t(),g(20,"input",11),t()(),n(21,"div",8)(22,"label",9),a(23),m(24,"translate"),t(),g(25,"input",12),t(),n(26,"div",8)(27,"label",9),a(28),m(29,"translate"),t(),g(30,"input",13),n(31,"small",14),a(32),m(33,"translate"),t()(),b(34,H,2,1,"div",15)(35,W,2,1,"div",16),n(36,"app-button",17),a(37),m(38,"translate"),t()(),n(39,"div",18)(40,"p"),a(41),m(42,"translate"),n(43,"a",19),a(44),m(45,"translate"),t()()()()()()),s&2&&(i(5),l(d(6,16,"auth.registerTitle")),i(2),v(7,e.invitationInfo?7:8),i(2),C("formGroup",e.registerForm),i(4),l(d(14,18,"auth.firstName")),i(5),l(d(19,20,"auth.lastName")),i(5),l(d(24,22,"auth.email")),i(5),l(d(29,24,"auth.password")),i(4),l(d(33,26,"auth.minPassword")),i(2),v(34,e.errorMessage?34:-1),i(),v(35,e.successMessage?35:-1),i(),C("fullWidth",!0)("loading",e.loading)("disabled",e.registerForm.invalid),i(),h(" ",d(38,28,"common.register")," "),i(4),h(" ",d(42,30,"auth.alreadyHaveAccount")," "),i(3),l(d(45,32,"common.login")))},dependencies:[P,q,B,N,T,F,V,z,R,E,A],styles:[".auth-page[_ngcontent-%COMP%]{min-height:calc(100vh - 73px);display:flex;align-items:center;justify-content:center;padding:2rem 1rem;background:linear-gradient(135deg,#6366f10d,#8b5cf60d)}.auth-container[_ngcontent-%COMP%]{width:100%;max-width:500px}.auth-card[_ngcontent-%COMP%]{background:var(--surface);border-radius:var(--radius-lg);padding:2.5rem;box-shadow:var(--shadow-lg)}.auth-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.auth-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-bottom:.5rem;background:linear-gradient(135deg,var(--primary) 0%,var(--secondary) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.auth-subtitle[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem}.auth-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-hint[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.813rem}.auth-footer[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;color:var(--text-secondary);font-size:.875rem}.auth-link[_ngcontent-%COMP%]{color:var(--primary);text-decoration:none;font-weight:600;transition:var(--transition)}.auth-link[_ngcontent-%COMP%]:hover{color:var(--primary-hover)}.invitation-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6366f11a,#8b5cf61a);border:1px solid rgba(99,102,241,.2);border-radius:8px;padding:1rem;margin-top:1rem;display:flex;gap:.75rem;align-items:flex-start}.invitation-banner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--primary);flex-shrink:0;margin-top:.125rem}.invitation-banner[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:var(--text-primary);margin-bottom:.25rem}.invitation-banner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:var(--text-secondary)}"]})}}return r})();export{ne as RegisterComponent};
