import{a as f}from"./chunk-NAK5AQJJ.js";import{g as S}from"./chunk-5CKBWUIT.js";import{a as n,b as u}from"./chunk-QRIHUA6I.js";import{A as d,N as g,Q as o,Sa as a,W as r,Wb as l,Xb as A,g as c,n as h}from"./chunk-KOA5EEQG.js";var m=(()=>{class i{constructor(){this.http=r(u),this.apiUrl=`${f.apiUrl}/apps`}getApps(t=!1){let e=new n().set("activeOnly",t.toString());return this.http.get(this.apiUrl,{params:e})}getActiveApps(){return this.getApps(!0)}getAppById(t){return this.http.get(`${this.apiUrl}/${t}`)}getAppByKey(t){return this.http.get(`${this.apiUrl}/key/${t}`)}createApp(t){return this.http.post(this.apiUrl,t)}updateApp(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}archiveApp(t){return this.http.delete(`${this.apiUrl}/${t}`)}restoreApp(t){return this.http.post(`${this.apiUrl}/${t}/restore`,{})}deleteAppPermanently(t){return this.http.delete(`${this.apiUrl}/${t}/permanent`)}searchApps(t){let e=new n().set("query",t);return this.http.get(`${this.apiUrl}/search`,{params:e})}getAppCount(t=!1){let e=new n().set("activeOnly",t.toString());return this.http.get(`${this.apiUrl}/count`,{params:e})}getAppStats(){return new c(t=>{this.getApps().subscribe({next:e=>{let s={totalApps:e.length,activeApps:e.filter(p=>p.status==="ACTIVE").length,archivedApps:e.filter(p=>p.status==="ARCHIVED").length};t.next(s),t.complete()},error:e=>t.error(e)})})}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var K=(()=>{class i{constructor(){this.appService=r(m),this.router=r(S),this.selectedAppSignal=a(null),this.appsSignal=a([]),this.loadingSignal=a(!1),this.errorSignal=a(null),this.selectedApp=this.selectedAppSignal.asReadonly(),this.apps=this.appsSignal.asReadonly(),this.loading=this.loadingSignal.asReadonly(),this.error=this.errorSignal.asReadonly(),this.hasApps=l(()=>this.apps().length>0),this.hasSelectedApp=l(()=>this.selectedApp()!==null),this.activeApps=l(()=>this.apps().filter(t=>t.status==="ACTIVE")),this.archivedApps=l(()=>this.apps().filter(t=>t.status==="ARCHIVED")),this.STORAGE_KEY="selectedAppId",this.loadApps(),A(()=>{let t=this.selectedApp();t?(localStorage.setItem(this.STORAGE_KEY,t.id.toString()),console.log("Saved selected app to localStorage:",t.id)):(localStorage.removeItem(this.STORAGE_KEY),console.log("Removed selected app from localStorage"))})}loadApps(){this.loadingSignal.set(!0),this.errorSignal.set(null),this.appService.getActiveApps().pipe(g(t=>{console.log("Loaded apps:",t),this.appsSignal.set(t),this.loadingSignal.set(!1),this.restoreOrAutoSelectApp(t)}),d(t=>(console.error("Error loading apps:",t),this.errorSignal.set("Failed to load applications"),this.loadingSignal.set(!1),h([])))).subscribe()}restoreOrAutoSelectApp(t){if(t.length===0){console.log("No apps available to select");return}let e=localStorage.getItem(this.STORAGE_KEY);if(console.log("Attempting to restore saved app ID:",e),e){let s=t.find(p=>p.id===parseInt(e));if(s){console.log("Restored saved app:",s.name),this.selectApp(s);return}else console.log("Saved app not found in current apps list, clearing localStorage"),localStorage.removeItem(this.STORAGE_KEY)}console.log("Auto-selecting first app:",t[0].name),this.selectApp(t[0])}autoSelectApp(t){this.restoreOrAutoSelectApp(t)}selectApp(t){let e=this.selectedApp();if(console.log("Selecting app:",t.name,"(ID:",t.id+")"),e?.id===t.id){console.log("App already selected, skipping");return}this.selectedAppSignal.set(t),window.dispatchEvent(new CustomEvent("appChanged",{detail:{app:t,previousApp:e}})),console.log("App selection changed from",e?.name||"none","to",t.name)}clearSelectedApp(){this.selectedAppSignal.set(null)}refreshApps(){this.loadApps()}addApp(t){let e=this.apps();this.appsSignal.set([...e,t]),this.selectApp(t)}updateApp(t){let e=this.apps(),s=e.findIndex(p=>p.id===t.id);if(s!==-1){let p=[...e];p[s]=t,this.appsSignal.set(p),this.selectedApp()?.id===t.id&&this.selectedAppSignal.set(t)}}removeApp(t){let s=this.apps().filter(p=>p.id!==t);this.appsSignal.set(s),this.selectedApp()?.id===t&&(this.clearSelectedApp(),s.length>0&&this.selectApp(s[0]))}getAppById(t){return this.apps().find(e=>e.id===t)}checkHasApps(){return this.hasApps()}navigateToAppCreationIfNeeded(){this.hasApps()||this.router.navigate(["/admin/apps/create"])}restoreSelectedApp(){let t=this.apps();t.length>0&&this.restoreOrAutoSelectApp(t)}getSavedAppId(){let t=localStorage.getItem(this.STORAGE_KEY);return t?parseInt(t):null}reset(){this.selectedAppSignal.set(null),this.appsSignal.set([]),this.loadingSignal.set(!1),this.errorSignal.set(null),localStorage.removeItem(this.STORAGE_KEY)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{m as a,K as b};
