<div class="error-code-management">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1>{{ 'errorCode.title' | translate }}</h1>
        <p class="subtitle" *ngIf="selectedApp()">
          Manage error codes for app "{{ selectedApp()!.name }}"
        </p>
        <p class="subtitle" *ngIf="!selectedApp()">
          Select an app to manage error codes
        </p>
      </div>
      <div class="header-actions" *ngIf="selectedApp()">
        <button class="btn btn-primary" (click)="openCreateModal()">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Create New Error Code for "{{ selectedApp()!.name }}"
        </button>
      </div>
    </div>
  </div>

  <!-- No App Selected State -->
  <div class="no-app-state" *ngIf="!selectedApp() && hasApps()">
    <div class="empty-state-content">
      <div class="empty-illustration">
        <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <defs>
            <linearGradient id="iconGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color: var(--primary); stop-opacity: 0.1" />
              <stop offset="100%" style="stop-color: var(--secondary); stop-opacity: 0.1" />
            </linearGradient>
          </defs>
          <circle cx="12" cy="12" r="10" fill="url(#iconGradient)" stroke="none" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
            style="stroke: var(--primary)" />
        </svg>
      </div>
      <h3>Select an App</h3>
      <p>Choose an app from the header dropdown to manage its error codes.</p>
    </div>
  </div>

  <!-- No Apps State -->
  <div class="no-apps-state" *ngIf="!hasApps()">
    <div class="empty-state-content">
      <div class="empty-illustration">
        <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <defs>
            <linearGradient id="iconGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color: var(--primary); stop-opacity: 0.1" />
              <stop offset="100%" style="stop-color: var(--secondary); stop-opacity: 0.1" />
            </linearGradient>
          </defs>
          <circle cx="12" cy="12" r="10" fill="url(#iconGradient)" stroke="none" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
            style="stroke: var(--primary)" />
        </svg>
      </div>
      <h3>Welcome to Error Codes</h3>
      <p>Start by creating your first application to manage error codes efficiently.</p>
      <div class="empty-actions">
        <a href="/admin/apps/create" class="btn btn-primary btn-lg">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          Create New App
        </a>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section" *ngIf="selectedApp()">
    <div class="filters-grid">
      <!-- Search -->
      <div class="filter-item search-filter">
        <input 
          type="text" 
          class="form-control"
          [value]="searchTerm()"
          (input)="searchTerm.set($any($event.target).value)"
          (keyup.enter)="onSearch()"
          placeholder="{{ 'errorCode.search' | translate }}">
        <button class="search-btn" (click)="onSearch()">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </button>
      </div>



      <!-- Category Filter -->
      <div class="filter-item">
        <select class="form-control" [value]="selectedCategory() || ''" (change)="onCategoryChange($any($event.target).value)">
          <option value="">{{ 'errorCode.allCategories' | translate }}</option>
          @for (category of categories(); track category.id) {
            <option [value]="category.id">{{ category.categoryName }}</option>
          }
        </select>
      </div>

      <!-- Severity Filter -->
      <div class="filter-item">
        <select class="form-control" [value]="selectedSeverity() || ''" (change)="onSeverityChange($any($event.target).value)">
          <option value="">{{ 'errorCode.allSeverities' | translate }}</option>
          @for (severity of severityOptions; track severity) {
            <option [value]="severity">{{ severity }}</option>
          }
        </select>
      </div>

      <!-- Status Filter -->
      <div class="filter-item">
        <select class="form-control" [value]="selectedStatus() || ''" (change)="onStatusChange($any($event.target).value)">
          <option value="">{{ 'errorCode.allStatuses' | translate }}</option>
          @for (status of statusOptions; track status) {
            <option [value]="status">{{ status }}</option>
          }
        </select>
      </div>

      <!-- View Toggle -->
      <div class="filter-item view-toggle">
        <button class="btn-icon" [class.active]="viewMode() === 'grid'" (click)="viewMode.set('grid')">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/>
          </svg>
        </button>
        <button class="btn-icon" [class.active]="viewMode() === 'list'" (click)="viewMode.set('list')">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/>
          </svg>
        </button>
      </div>
    </div>

    @if (hasFilters()) {
      <button class="btn-clear-filters" (click)="clearFilters()">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
        {{ 'errorCode.clearFilters' | translate }}
      </button>
    }
  </div>

  <!-- Main Content (only show when app is selected) -->
  <div *ngIf="selectedApp()">
    <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  }

  <!-- Error Codes Grid/List -->
  @if (!loading()) {
    @if (errorCodes().length === 0) {
      <div class="empty-state">
        <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
        <h3>{{ 'errorCode.noResults' | translate }}</h3>
        <p>{{ 'errorCode.noResultsDesc' | translate }}</p>
      </div>
    } @else {
      <!-- Grid View -->
      @if (viewMode() === 'grid') {
        <div class="error-codes-grid">
          @for (errorCode of errorCodes(); track errorCode.id) {
            <div class="error-code-card">
              <div class="card-header">
                <div class="code-badge">{{ errorCode.errorCode }}</div>
                <div class="card-actions">
                  <button class="btn-icon-sm" (click)="openEditModal(errorCode)" title="Edit">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                  </button>
                  <button class="btn-icon-sm btn-danger" (click)="deleteErrorCode(errorCode.id!)" title="Delete">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                </div>
              </div>
              
              <div class="card-body">
                <div class="badges">
                  <span class="badge" [ngClass]="getSeverityClass(errorCode.severity)">
                    {{ errorCode.severity }}
                  </span>
                  <span class="badge" [ngClass]="getStatusClass(errorCode.status)">
                    {{ errorCode.status }}
                  </span>
                  @if (errorCode.httpStatusCode) {
                    <span class="badge badge-http">HTTP {{ errorCode.httpStatusCode }}</span>
                  }
                </div>

                <h3 class="card-title">{{ errorCode.defaultMessage }}</h3>
                
                <div class="card-meta">
                  <div class="meta-item">
                    <span class="meta-label">App:</span>
                    <span class="meta-value">{{ errorCode.appName }}</span>
                  </div>
                  @if (errorCode.moduleName) {
                    <div class="meta-item">
                      <span class="meta-label">Module:</span>
                      <span class="meta-value">{{ errorCode.moduleName }}</span>
                    </div>
                  }
                  @if (errorCode.categoryId) {
                    <div class="meta-item">
                      <span class="meta-label">Category:</span>
                      <span class="meta-value">{{ getCategoryName(errorCode.categoryId) }}</span>
                    </div>
                  }
                </div>

                <div class="card-flags">
                  @if (errorCode.isPublic) {
                    <span class="flag flag-public">Public</span>
                  }
                  @if (errorCode.isRetryable) {
                    <span class="flag flag-retryable">Retryable</span>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      }

      <!-- List View -->
      @if (viewMode() === 'list') {
        <div class="error-codes-table">
          <table>
            <thead>
              <tr>
                <th>Code</th>
                <th>Message</th>
                <th>App</th>
                <th>Category</th>
                <th>Severity</th>
                <th>Status</th>
                <th>HTTP</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (errorCode of errorCodes(); track errorCode.id) {
                <tr>
                  <td><span class="code-badge-sm">{{ errorCode.errorCode }}</span></td>
                  <td class="message-cell">{{ errorCode.defaultMessage }}</td>
                  <td>{{ errorCode.appName }}</td>
                  <td>{{ getCategoryName(errorCode.categoryId) }}</td>
                  <td>
                    <span class="badge badge-sm" [ngClass]="getSeverityClass(errorCode.severity)">
                      {{ errorCode.severity }}
                    </span>
                  </td>
                  <td>
                    <span class="badge badge-sm" [ngClass]="getStatusClass(errorCode.status)">
                      {{ errorCode.status }}
                    </span>
                  </td>
                  <td>{{ errorCode.httpStatusCode || '-' }}</td>
                  <td class="actions-cell">
                    <button class="btn-icon-sm" (click)="openEditModal(errorCode)">
                      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                      </svg>
                    </button>
                    <button class="btn-icon-sm btn-danger" (click)="deleteErrorCode(errorCode.id!)">
                      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                      </svg>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }

      <!-- Pagination -->
      @if (totalPages() > 1) {
        <div class="pagination">
          <button class="btn-page" [disabled]="currentPage() === 0" (click)="previousPage()">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          
          <span class="page-info">
            Page {{ currentPage() + 1 }} of {{ totalPages() }} ({{ totalElements() }} total)
          </span>
          
          <button class="btn-page" [disabled]="currentPage() >= totalPages() - 1" (click)="nextPage()">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      }
    }
  }
</div>

<!-- Create/Edit Modal -->
@if (showModal() && currentErrorCode()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ modalMode() === 'create' ? 'Create New Error Code for "' + selectedApp()?.name + '"' : 'Edit Error Code' }}</h2>
        <button class="btn-close" (click)="closeModal()">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-grid">
          <!-- Error Code -->
          <div class="form-group">
            <label>{{ 'errorCode.code' | translate }} *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentErrorCode()!.errorCode"
              placeholder="e.g., AUTH_001">
          </div>



          <!-- Module Name -->
          <div class="form-group">
            <label>{{ 'errorCode.moduleName' | translate }}</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentErrorCode()!.moduleName"
              placeholder="e.g., Authentication">
          </div>

          <!-- Category -->
          <div class="form-group">
            <label>{{ 'errorCode.category' | translate }}</label>
            <select class="form-control" [(ngModel)]="currentErrorCode()!.categoryId">
              <option [ngValue]="undefined">{{ 'errorCode.none' | translate }}</option>
              @for (category of categories(); track category.id) {
                <option [ngValue]="category.id">{{ category.categoryName }}</option>
              }
            </select>
          </div>

          <!-- Severity -->
          <div class="form-group">
            <label>{{ 'errorCode.severity' | translate }} *</label>
            <select class="form-control" [(ngModel)]="currentErrorCode()!.severity">
              @for (severity of severityOptions; track severity) {
                <option [value]="severity">{{ severity }}</option>
              }
            </select>
          </div>

          <!-- Status -->
          <div class="form-group">
            <label>{{ 'errorCode.status' | translate }} *</label>
            <select class="form-control" [(ngModel)]="currentErrorCode()!.status">
              @for (status of statusOptions; track status) {
                <option [value]="status">{{ status }}</option>
              }
            </select>
          </div>

          <!-- HTTP Status Code -->
          <div class="form-group">
            <label>{{ 'errorCode.httpCode' | translate }}</label>
            <input 
              type="number" 
              class="form-control"
              [(ngModel)]="currentErrorCode()!.httpStatusCode"
              placeholder="e.g., 400">
          </div>

          <!-- Flags -->
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="currentErrorCode()!.isPublic">
              <span>{{ 'errorCode.isPublic' | translate }}</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="currentErrorCode()!.isRetryable">
              <span>{{ 'errorCode.isRetryable' | translate }}</span>
            </label>
          </div>
        </div>

        <!-- Default Message -->
        <div class="form-group">
          <label>{{ 'errorCode.defaultMessage' | translate }} *</label>
          <textarea 
            class="form-control"
            [(ngModel)]="currentErrorCode()!.defaultMessage"
            rows="2"
            [placeholder]="'errorCode.defaultMessage' | translate"></textarea>
        </div>

        <!-- Technical Details -->
        <div class="form-group">
          <label>{{ 'errorCode.technicalDetails' | translate }}</label>
          <textarea 
            class="form-control"
            [(ngModel)]="currentErrorCode()!.technicalDetails"
            rows="2"
            [placeholder]="'errorCode.technicalDetails' | translate"></textarea>
        </div>

        <!-- Resolution Steps -->
        <div class="form-group">
          <label>{{ 'errorCode.resolutionSteps' | translate }}</label>
          <textarea 
            class="form-control"
            [(ngModel)]="currentErrorCode()!.resolutionSteps"
            rows="2"
            [placeholder]="'errorCode.resolutionSteps' | translate"></textarea>
        </div>

        <!-- Documentation URL -->
        <div class="form-group">
          <label>{{ 'errorCode.documentationUrl' | translate }}</label>
          <input 
            type="url" 
            class="form-control"
            [(ngModel)]="currentErrorCode()!.documentationUrl"
            placeholder="https://docs.example.com/errors/AUTH_001">
        </div>

        <!-- Translations -->
        <div class="translations-section">
          <div class="translations-header">
            <h3>{{ 'errorCode.translations' | translate }}</h3>
            <div class="add-language-dropdown">
              <select 
                class="form-control form-control-sm"
                (change)="addLanguage($any($event.target).value); $any($event.target).value = ''">
                <option value="">+ Add Language</option>
                @for (lang of getAvailableLanguagesToAdd(); track lang.code) {
                  <option [value]="lang.code">{{ lang.name }} ({{ lang.nativeName }})</option>
                }
              </select>
            </div>
          </div>
          
          <!-- Dynamic Language Translations -->
          @for (langCode of selectedLanguages(); track langCode) {
            <div class="translation-group">
              <div class="translation-group-header">
                <h4>{{ getLanguageName(langCode) }}</h4>
                @if (langCode !== 'en') {
                  <button 
                    type="button"
                    class="btn-remove-lang" 
                    (click)="removeLanguage(langCode)"
                    title="Remove language">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                }
              </div>
              <div class="form-group">
                <label>{{ 'errorCode.message' | translate }}</label>
                <input 
                  type="text" 
                  class="form-control"
                  [value]="getTranslation(langCode, 'message')"
                  (input)="updateTranslation(langCode, 'message', $any($event.target).value)">
              </div>
            </div>
          }
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">{{ 'common.cancel' | translate }}</button>
        <button class="btn btn-primary" (click)="saveErrorCode()">
          {{ modalMode() === 'create' ? ('common.create' | translate) : ('common.save' | translate) }}
        </button>
      </div>
    </div>
  </div>
}
  </div> <!-- End main content wrapper -->
