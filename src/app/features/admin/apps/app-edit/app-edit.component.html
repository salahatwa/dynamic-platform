<div class="app-edit-container">
  <div class="page-header">
    <div class="header-breadcrumb">
      <a routerLink="/admin/apps" class="breadcrumb-link">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        {{ 'apps.title' | translate }}
      </a>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-current">{{ 'apps.edit' | translate }}</span>
    </div>
    
    <h1 class="page-title">{{ 'apps.edit' | translate }}</h1>
    @if (app(); as currentApp) {
      <p class="page-subtitle">Editing: {{ currentApp.name }}</p>
    }
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  } @else if (error() && !app()) {
    <!-- Error State -->
    <div class="error-state">
      <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" 
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <h2>{{ error() }}</h2>
      <a routerLink="/admin/apps" class="btn btn-primary">
        Back to Apps
      </a>
    </div>
  } @else if (app()) {
    <!-- Form -->
    <!-- Error Alert -->
    @if (error()) {
      <div class="alert alert-danger">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span>{{ error() }}</span>
      </div>
    }

    <form (ngSubmit)="onSubmit()" class="app-form">
      <div class="form-card">
        <h2 class="form-section-title">Basic Information</h2>
        
        <div class="form-group">
          <label class="form-label required">
            {{ 'apps.name' | translate }}
          </label>
          <input 
            type="text" 
            class="form-input"
            [value]="formData().name"
            (input)="updateField('name', $any($event.target).value)"
            placeholder="My Mobile App"
            required
            maxlength="255">
          <p class="form-help">Choose a descriptive name for your application</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            {{ 'apps.description' | translate }}
          </label>
          <textarea 
            class="form-textarea"
            [value]="formData().description || ''"
            (input)="updateField('description', $any($event.target).value)"
            placeholder="A brief description of your application..."
            rows="4"
            maxlength="1000"></textarea>
          <p class="form-help">Optional description to help identify this app</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            {{ 'apps.iconUrl' | translate }}
          </label>
          <input 
            type="url" 
            class="form-input"
            [value]="formData().iconUrl || ''"
            (input)="updateField('iconUrl', $any($event.target).value)"
            placeholder="https://example.com/icon.png">
          <p class="form-help">Optional URL to an icon image for this app</p>
        </div>

        <!-- Icon Preview -->
        @if (formData().iconUrl) {
          <div class="icon-preview">
            <label class="form-label">Icon Preview</label>
            <div class="preview-container">
              <img 
                [src]="formData().iconUrl" 
                alt="App icon preview"
                (error)="updateField('iconUrl', '')"
                class="preview-image">
            </div>
          </div>
        }
      </div>

      <!-- App Info Card -->
      <div class="info-card">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div>
          <h3>Application Details</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">App Key:</span>
              <code class="info-value">{{ app()!.appKey }}</code>
            </div>
            <div class="info-item">
              <span class="info-label">Status:</span>
              <span class="info-value">{{ app()!.status }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Created:</span>
              <span class="info-value">{{ app()!.createdAt | date:'medium' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Updated:</span>
              <span class="info-value">{{ app()!.updatedAt | date:'medium' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="cancel()"
          [disabled]="saving()">
          {{ 'common.cancel' | translate }}
        </button>
        
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="!canSubmit()">
          @if (saving()) {
            <div class="btn-spinner"></div>
            <span>Saving...</span>
          } @else {
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M5 13l4 4L19 7"/>
            </svg>
            <span>{{ 'common.save' | translate }}</span>
          }
        </button>
      </div>
    </form>
  }
</div>
